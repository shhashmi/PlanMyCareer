openapi: 3.0.3
info:
  title: AI Fluency Assessment API
  description: |
    API for AI Fluency assessment platform. Allows users to take assessments,
    track progress, and view analytics.

    ## Authentication
    Most endpoints require authentication via JWT token stored in a cookie.
    Users authenticate via OAuth providers (Google, GitHub, LinkedIn).
  version: 1.0.0
  contact:
    name: API Support

servers:
  - url: http://localhost:8080
    description: Development server
  - url: https://api.aifluens.com
    description: Production server

tags:
  - name: Health
    description: Health check endpoints
  - name: Auth
    description: Authentication endpoints
  - name: Profile
    description: User profile management
  - name: Questions
    description: Question and metadata endpoints
  - name: Assessments
    description: Assessment session management
  - name: Reports
    description: Reporting and aggregate summaries
  - name: Fluency
    description: Fluency profile resolution
  - name: Email
    description: Email enquiry endpoints

paths:
  /:
    get:
      tags:
        - Health
      summary: Welcome message
      responses:
        '200':
          description: Welcome message
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "AI Fluency API Server - Endpoint: POST /api/fluency/resolve"

  /health:
    get:
      tags:
        - Health
      summary: Health check
      responses:
        '200':
          description: Server is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"

  /api/v1/fluency/resolve:
    post:
      tags:
        - Fluency
      summary: Resolve fluency profile (v1)
      description: |
        Resolves a user's fluency profile based on their experience and role.
        **Deprecated:** Use v2 endpoint for priority information.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FluencyInput'
      responses:
        '200':
          description: Fluency profile resolved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FluencyProfileV1'
        '400':
          description: Missing required parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v2/fluency/resolve:
    post:
      tags:
        - Fluency
      summary: Resolve fluency profile (v2)
      description: |
        Resolves a user's fluency profile based on their experience and role.
        Includes priority ranking (1-10) for each dimension based on role and experience level.
        Lower priority number = higher importance for the role.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FluencyInput'
      responses:
        '200':
          description: Fluency profile resolved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FluencyProfileV2'
        '400':
          description: Missing required parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/auth/login/{provider}:
    get:
      tags:
        - Auth
      summary: Initiate OAuth login
      description: Redirects user to OAuth provider for authentication
      parameters:
        - name: provider
          in: path
          required: true
          schema:
            type: string
            enum: [google, github, linkedin]
          description: OAuth provider
      responses:
        '302':
          description: Redirect to OAuth provider
        '400':
          description: Invalid provider
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/auth/callback/google:
    get:
      tags:
        - Auth
      summary: Google OAuth callback
      description: Handles Google OAuth callback and sets JWT cookie
      responses:
        '302':
          description: Redirect to frontend with auth cookie set

  /api/v1/auth/callback/github:
    get:
      tags:
        - Auth
      summary: GitHub OAuth callback
      description: Handles GitHub OAuth callback and sets JWT cookie
      responses:
        '302':
          description: Redirect to frontend with auth cookie set

  /api/v1/auth/callback/linkedin:
    get:
      tags:
        - Auth
      summary: LinkedIn OAuth callback
      description: Handles LinkedIn OAuth callback and sets JWT cookie
      responses:
        '302':
          description: Redirect to frontend with auth cookie set

  /api/v1/auth/me:
    get:
      tags:
        - Auth
      summary: Get current user
      description: Returns the currently authenticated user's information
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Current user data
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
        '401':
          description: Not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/auth/logout:
    post:
      tags:
        - Auth
      summary: Logout user
      description: Clears the authentication cookie
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"

  /api/v1/profile:
    post:
      tags:
        - Profile
      summary: Create new profile
      description: |
        Creates a new profile for the authenticated user.
        Creates a new record each time (append-only behavior).
        Deactivates any existing active profile.
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProfileRequest'
            example:
              role: "Software Engineer"
              experience_years: 5
              company: "Tech Corp"
              country: "United States"
              name: "John Doe"
              title: "Senior Developer"
              company_type: "Startup"
              geography: "North America"
              goal: "Career growth"
      responses:
        '201':
          description: Profile created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    type: object
                    properties:
                      profile:
                        $ref: '#/components/schemas/UserProfile'
        '400':
          description: Missing required fields or validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: User not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    get:
      tags:
        - Profile
      summary: Get current profile
      description: Returns the current (active) profile for the authenticated user
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Current profile data (null if no profile exists)
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    type: object
                    properties:
                      profile:
                        oneOf:
                          - $ref: '#/components/schemas/UserProfile'
                          - type: 'null'
        '401':
          description: User not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/profile/history:
    get:
      tags:
        - Profile
      summary: Get profile history
      description: Returns all profiles (history) for the authenticated user, ordered by most recent first
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Profile history retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    type: object
                    properties:
                      profiles:
                        type: array
                        items:
                          $ref: '#/components/schemas/UserProfile'
                      count:
                        type: integer
                        description: Total number of profiles
                        example: 3
        '401':
          description: User not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/profile/check:
    get:
      tags:
        - Profile
      summary: Check if user has profile
      description: Returns whether the authenticated user has an active profile
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Profile check result
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    type: object
                    properties:
                      hasProfile:
                        type: boolean
                        example: true
        '401':
          description: User not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/questions/dimensions:
    get:
      tags:
        - Questions
      summary: Get all dimensions
      description: Returns all available assessment dimensions
      responses:
        '200':
          description: List of dimensions
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    type: object
                    properties:
                      dimensions:
                        type: array
                        items:
                          $ref: '#/components/schemas/Dimension'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/questions/roles:
    get:
      tags:
        - Questions
      summary: Get all roles
      description: Returns all available job roles for assessments
      responses:
        '200':
          description: List of roles
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    type: object
                    properties:
                      roles:
                        type: array
                        items:
                          $ref: '#/components/schemas/Role'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/assessments/start:
    post:
      tags:
        - Assessments
      summary: Start a new assessment
      description: |
        Creates a new assessment session and returns questions.
        User profile data (experience_years, company, country) is retrieved from the user's active profile.
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssessmentStartRequest'
            example:
              assessment_type: "basic"
              role: "Software Engineer"
              evaluated_dimensions:
                - dimension: "FND"
                  difficulty_level: "Basic"
                  priority: 8
                - dimension: "PRM"
                  difficulty_level: "Intermediate"
                  priority: 6
                - dimension: "ASE"
                  difficulty_level: "Basic"
                  priority: 5
              question_count: 15
      responses:
        '201':
          description: Assessment started successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    $ref: '#/components/schemas/AssessmentStartResponse'
        '401':
          description: User not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/assessments/resume:
    post:
      tags:
        - Assessments
      summary: Resume incomplete assessment
      description: Resumes the user's last incomplete assessment session
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Assessment resumed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    $ref: '#/components/schemas/AssessmentResumeResponse'
        '401':
          description: User not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: No incomplete assessment found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/assessments/save-answer:
    post:
      tags:
        - Assessments
      summary: Save an answer
      description: Saves the user's answer for a specific question
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveAnswerRequest'
            example:
              session_id: 1
              question_id: 101
              selected_option: "A"
      responses:
        '200':
          description: Answer saved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    type: object
                    properties:
                      is_correct:
                        type: boolean
                        example: true
                      message:
                        type: string
                        example: "Answer saved successfully"
        '400':
          description: Missing required fields or assessment already completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: User not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Invalid session or question not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/assessments/submit:
    post:
      tags:
        - Assessments
      summary: Submit assessment
      description: Marks the assessment as complete and returns the updated session
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SubmitAssessmentRequest'
            example:
              session_id: 1
      responses:
        '200':
          description: Assessment submitted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    $ref: '#/components/schemas/AssessmentSession'
        '400':
          description: Missing session_id or assessment already completed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: User not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Invalid session
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/assessments/{session_id}/summary:
    get:
      tags:
        - Assessments
      summary: Get assessment summary
      description: |
        Returns assessment summary with metadata and competency breakdown.
        Validates that the assessment belongs to the authenticated user.
      security:
        - cookieAuth: []
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            type: integer
          description: The assessment session ID
          example: 1
      responses:
        '200':
          description: Assessment summary retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    $ref: '#/components/schemas/AssessmentSummary'
        '400':
          description: Invalid session_id parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: User not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Assessment does not belong to the authenticated user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Assessment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/assessments/incomplete:
    get:
      tags:
        - Assessments
      summary: Check for incomplete assessment
      description: Checks if the authenticated user has an incomplete assessment session
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Incomplete assessment check result
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    $ref: '#/components/schemas/IncompleteAssessmentResponse'
        '401':
          description: User not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/assessments/{session_id}/reset:
    post:
      tags:
        - Assessments
      summary: Reset assessment session
      description: |
        Resets/deletes an incomplete assessment session.
        Only works for incomplete assessments owned by the authenticated user.
      security:
        - cookieAuth: []
      parameters:
        - name: session_id
          in: path
          required: true
          schema:
            type: integer
          description: The assessment session ID to reset
          example: 1
      responses:
        '200':
          description: Assessment session reset successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Assessment session reset successfully"
        '400':
          description: Invalid session_id parameter
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: User not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Assessment not found or unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/reports/basic-assessment:
    get:
      tags:
        - Reports
      summary: Get basic assessment report
      description: |
        Returns an aggregate report across all completed basic assessments for the authenticated user.
        Includes overall score and per-dimension breakdown.
      security:
        - cookieAuth: []
      responses:
        '200':
          description: Report retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  data:
                    $ref: '#/components/schemas/BasicAssessmentReport'
        '401':
          description: User not authenticated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/email/send:
    post:
      tags:
        - Email
      summary: Send enquiry email
      description: |
        Stores an enquiry email in the database. This is a fire-and-forget operation.
        The email data is saved to the enquiry_mails table for later processing.
        No authentication required.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SendEmailRequest'
            example:
              to: "support@example.com"
              subject: "Question about AI Fluency"
              text: "I have a question about the assessment..."
      responses:
        '200':
          description: Email queued for delivery
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "success"
                  message:
                    type: string
                    example: "Email queued for delivery"
        '400':
          description: Missing required fields
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: token
      description: JWT token stored in cookie after OAuth login

  schemas:
    Error:
      type: object
      properties:
        status:
          type: string
          example: "error"
        message:
          type: string
          example: "Error message"

    SendEmailRequest:
      type: object
      required:
        - to
        - subject
      properties:
        to:
          type: string
          format: email
          description: Recipient email address
          example: "support@example.com"
        subject:
          type: string
          description: Email subject
          example: "Question about AI Fluency"
        text:
          type: string
          description: Plain text email body (required if html not provided)
          example: "I have a question about the assessment..."
        html:
          type: string
          description: HTML email body (required if text not provided)
          example: "<p>I have a question about the assessment...</p>"

    User:
      type: object
      properties:
        id:
          type: string
          example: "123"
        loginId:
          type: string
          example: "google-oauth-id"
        name:
          type: string
          example: "John Doe"
        provider:
          type: string
          enum: [google, github, linkedin]
          example: "google"

    CreateProfileRequest:
      type: object
      required:
        - role
        - experience_years
        - company
        - country
      properties:
        role:
          type: string
          description: Job role
          example: "Software Engineer"
        experience_years:
          type: integer
          description: Years of experience
          example: 5
        company:
          type: string
          description: Company name
          example: "Tech Corp"
        country:
          type: string
          description: Country
          example: "United States"
        name:
          type: string
          description: User's display name (optional)
          example: "John Doe"
        title:
          type: string
          description: Job title (optional)
          example: "Senior Developer"
        company_type:
          type: string
          description: Type of company (optional)
          example: "Startup"
        geography:
          type: string
          description: Geographic region (optional)
          example: "North America"
        goal:
          type: string
          description: Career goal (optional)
          example: "Career growth"
        metadata:
          type: object
          description: Additional metadata (optional)
          additionalProperties: true

    UserProfile:
      type: object
      properties:
        profile_id:
          type: integer
          description: Unique profile identifier
          example: 1
        user_id:
          type: integer
          description: User ID this profile belongs to
          example: 123
        name:
          type: string
          nullable: true
          example: "John Doe"
        role:
          type: string
          example: "Software Engineer"
        title:
          type: string
          nullable: true
          example: "Senior Developer"
        experience_years:
          type: integer
          example: 5
        company:
          type: string
          example: "Tech Corp"
        country:
          type: string
          example: "United States"
        company_type:
          type: string
          nullable: true
          example: "Startup"
        geography:
          type: string
          nullable: true
          example: "North America"
        goal:
          type: string
          nullable: true
          example: "Career growth"
        is_active:
          type: boolean
          description: Whether this is the current active profile
          example: true
        metadata:
          type: object
          nullable: true
          additionalProperties: true
        created_at:
          type: string
          format: date-time

    IncompleteAssessmentResponse:
      type: object
      properties:
        has_incomplete:
          type: boolean
          description: Whether user has an incomplete assessment
          example: true
        session:
          type: object
          nullable: true
          description: Session details if incomplete assessment exists
          properties:
            session_id:
              type: integer
              example: 1
            assessment_type:
              type: string
              enum: [basic, advanced]
              example: "basic"
            started_at:
              type: string
              format: date-time
            answered_count:
              type: integer
              description: Number of questions already answered
              example: 5
            total_questions:
              type: integer
              description: Total questions in the assessment
              example: 15

    Dimension:
      type: object
      properties:
        dimension_id:
          type: integer
          example: 1
        dimension_code:
          type: string
          enum: [FND, PRM, ASE, ETH, COL]
          example: "FND"
        name:
          type: string
          example: "Foundational"
        description:
          type: string
          example: "Core AI/ML concepts and fundamentals"
        display_order:
          type: integer
          example: 1
        created_at:
          type: string
          format: date-time

    Role:
      type: object
      properties:
        role_id:
          type: integer
          example: 1
        name:
          type: string
          example: "Software Engineer"
        created_at:
          type: string
          format: date-time

    Question:
      type: object
      properties:
        question_id:
          type: integer
          example: 101
        question_text:
          type: string
          example: "What is the primary purpose of a neural network?"
        difficulty_level:
          type: string
          enum: [Basic, Intermediate, Advanced, Expert]
          example: "Basic"
        dimension:
          type: string
          enum: [FND, PRM, ASE, ETH, COL]
          example: "FND"
        option_a:
          type: string
          example: "To store data"
        option_b:
          type: string
          example: "To learn patterns from data"
        option_c:
          type: string
          example: "To connect computers"
        option_d:
          type: string
          example: "To encrypt information"
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    QuestionWithState:
      allOf:
        - $ref: '#/components/schemas/Question'
        - type: object
          properties:
            is_answered:
              type: boolean
              example: false
            selected_option:
              type: string
              enum: [A, B, C, D, null]
              nullable: true
              example: null

    EvaluatedDimension:
      type: object
      required:
        - dimension
        - difficulty_level
        - priority
      properties:
        dimension:
          type: string
          enum: [FND, PRM, ASE, ETH, COL]
          description: |
            Dimension code:
            - FND: Foundational
            - PRM: Prompting
            - ASE: AI-assisted Software Engineering
            - ETH: Ethics
            - COL: Collaboration
          example: "FND"
        difficulty_level:
          type: string
          enum: [Basic, Intermediate, Advanced, Expert]
          example: "Basic"
        priority:
          type: integer
          description: Priority level for this dimension (1-10, where 10 = highest priority)
          minimum: 1
          maximum: 10
          example: 8

    AssessmentStartRequest:
      type: object
      required:
        - assessment_type
        - role
        - evaluated_dimensions
        - question_count
      properties:
        assessment_type:
          type: string
          enum: [basic, advanced]
          example: "basic"
        role:
          type: string
          example: "Software Engineer"
        evaluated_dimensions:
          type: array
          items:
            $ref: '#/components/schemas/EvaluatedDimension'
          minItems: 1
        question_count:
          type: integer
          example: 15

    AssessmentStartResponse:
      type: object
      properties:
        session_id:
          type: integer
          example: 1
        assessment_type:
          type: string
          enum: [basic, advanced]
          example: "basic"
        started_at:
          type: string
          format: date-time
        questions:
          type: array
          items:
            $ref: '#/components/schemas/Question'

    AssessmentResumeResponse:
      type: object
      properties:
        session_id:
          type: integer
          example: 1
        assessment_type:
          type: string
          enum: [basic, advanced]
          example: "basic"
        started_at:
          type: string
          format: date-time
        questions:
          type: array
          items:
            $ref: '#/components/schemas/QuestionWithState'
        answered_count:
          type: integer
          example: 5
        total_questions:
          type: integer
          example: 15

    SaveAnswerRequest:
      type: object
      required:
        - session_id
        - question_id
        - selected_option
      properties:
        session_id:
          type: integer
          example: 1
        question_id:
          type: integer
          example: 101
        selected_option:
          type: string
          enum: [A, B, C, D]
          example: "A"

    SubmitAssessmentRequest:
      type: object
      required:
        - session_id
      properties:
        session_id:
          type: integer
          example: 1

    DimensionScores:
      type: object
      additionalProperties:
        type: integer
        minimum: 0
        maximum: 100
      example:
        FND: 80
        PRM: 65
        ASE: 90

    AssessmentResults:
      type: object
      properties:
        session_id:
          type: integer
          example: 1
        total_questions:
          type: integer
          example: 15
        dimension_scores:
          $ref: '#/components/schemas/DimensionScores'
        completed_at:
          type: string
          format: date-time

    BasicAssessmentReport:
      type: object
      properties:
        user_id:
          type: integer
          example: 123
        total_assessments:
          type: integer
          description: Total number of completed basic assessments
          example: 5
        total_questions:
          type: integer
          description: Total questions answered across all basic assessments
          example: 75
        total_correct:
          type: integer
          description: Total correct answers across all basic assessments
          example: 60
        overall_score_percentage:
          type: integer
          description: Overall accuracy percentage
          minimum: 0
          maximum: 100
          example: 80
        dimension_scores:
          type: array
          description: Per-dimension breakdown
          items:
            $ref: '#/components/schemas/DimensionScoreBreakdown'

    DimensionScoreBreakdown:
      type: object
      properties:
        dimension:
          type: string
          description: Dimension code
          example: "FND"
        total_questions:
          type: integer
          description: Total questions for this dimension
          example: 15
        correct_answers:
          type: integer
          description: Correct answers for this dimension
          example: 12
        score_percentage:
          type: integer
          description: Accuracy percentage for this dimension
          minimum: 0
          maximum: 100
          example: 80
        difficulty_level:
          type: string
          description: Difficulty level from the most recent assessment
          enum: [Basic, Intermediate, Advanced, Expert]
          example: "Intermediate"

    AssessmentSession:
      type: object
      properties:
        session_id:
          type: integer
          example: 1
        user_id:
          type: integer
          example: 123
        assessment_type:
          type: string
          enum: [basic, advanced]
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
          nullable: true
        is_complete:
          type: boolean
          description: Whether the assessment has been completed
          example: true
        metadata:
          $ref: '#/components/schemas/AssessmentMetadata'

    FluencyInput:
      type: object
      required:
        - experience_years
        - role
        - company
        - country
      properties:
        experience_years:
          type: integer
          description: Years of experience
          example: 5
        role:
          type: string
          example: "Software Engineer"
        title:
          type: string
          example: "Senior Developer"
        company:
          type: string
          example: "Tech Corp"
        country:
          type: string
          example: "United States"
        company_type:
          type: string
          example: "Startup"
        geography:
          type: string
          example: "North America"
        goal:
          type: string
          example: "Career growth"
        min_fluency_level:
          type: string
          enum: [Basic, Intermediate, Advanced, Expert]
          description: |
            Optional filter to return only dimensions at or above this fluency level.
            - Basic: return all dimensions
            - Intermediate: exclude Basic level dimensions
            - Advanced: exclude Basic and Intermediate level dimensions
            - Expert: return only Expert level dimensions
          example: "Intermediate"

    FluencyProfileV1:
      type: object
      properties:
        profile:
          type: array
          items:
            $ref: '#/components/schemas/DimensionProfileV1'
        metadata:
          $ref: '#/components/schemas/FluencyMetadata'

    FluencyProfileV2:
      type: object
      properties:
        profile:
          type: array
          items:
            $ref: '#/components/schemas/DimensionProfileV2'
        metadata:
          $ref: '#/components/schemas/FluencyMetadata'

    DimensionProfileV1:
      type: object
      properties:
        name:
          type: string
          description: Full name of the dimension
          example: "AI Foundations & Mental Models"
        description:
          type: string
          description: Description of the dimension
          example: "Understanding of AI capabilities and limitations"
        proficiency:
          type: string
          enum: [Basic, Intermediate, Advanced, Expert]
          example: "Intermediate"

    DimensionProfileV2:
      type: object
      properties:
        name:
          type: string
          description: Full name of the dimension
          example: "Prompting & Human-AI Interaction"
        description:
          type: string
          description: Description of the dimension
          example: "Effective communication with AI systems"
        proficiency:
          type: string
          enum: [Basic, Intermediate, Advanced, Expert]
          example: "Intermediate"
        priority:
          type: integer
          minimum: 1
          maximum: 10
          description: Priority ranking for this dimension (1 = highest priority, 10 = lowest)
          example: 1

    FluencyMetadata:
      type: object
      properties:
        experience_range:
          type: string
          description: Experience range bucket
          example: "2-4"
        role:
          type: string
          example: "software engineer"
        title:
          type: string
          example: "Software Engineer"
        company:
          type: string
          example: "Tech Corp"
        country:
          type: string
          example: "US"
        company_type:
          type: string
          example: "Startup"
        geography:
          type: string
          example: "US"
        goal:
          type: string
          nullable: true
          example: null
        max_allowed_level:
          type: string
          description: Maximum proficiency level allowed based on experience
          example: "Intermediate"

    CompetencyBreakdown:
      type: object
      properties:
        dimension:
          type: string
          description: Dimension/competency code
          example: "FND"
        total_questions:
          type: integer
          description: Total number of questions in this competency
          example: 6
        correct_answers:
          type: integer
          description: Number of correctly answered questions in this competency
          example: 5

    AssessmentMetadata:
      type: object
      properties:
        experience_years:
          type: integer
          example: 5
        company:
          type: string
          example: "Tech Corp"
        country:
          type: string
          example: "United States"
        role:
          type: string
          example: "backend engineer"
      additionalProperties: true

    AssessmentSummary:
      type: object
      properties:
        session_id:
          type: integer
          example: 1
        assessment_type:
          type: string
          enum: [basic, advanced]
          example: "basic"
        started_at:
          type: string
          format: date-time
        completed_at:
          type: string
          format: date-time
          nullable: true
        metadata:
          $ref: '#/components/schemas/AssessmentMetadata'
        total_questions:
          type: integer
          description: Total number of questions in the assessment
          example: 30
        total_correct:
          type: integer
          description: Total number of correctly answered questions
          example: 22
        competency_breakdown:
          type: array
          description: Breakdown of questions and correct answers per competency
          items:
            $ref: '#/components/schemas/CompetencyBreakdown'
          example:
            - dimension: "FND"
              total_questions: 6
              correct_answers: 5
            - dimension: "PRM"
              total_questions: 6
              correct_answers: 4
            - dimension: "ASE"
              total_questions: 6
              correct_answers: 5
